
local player = game.Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")
local UIS = game:GetService("UserInputService")
local VirtualInputManager = game:GetService("VirtualInputManager")

if playerGui:FindFirstChild("BiskHub") then
    playerGui.BiskHub:Destroy()
end

local screenGui = Instance.new("ScreenGui")
screenGui.Name = "BiskHub"
screenGui.Parent = playerGui
screenGui.ResetOnSpawn = false


local IconImage = Instance.new("ImageButton")
IconImage.Name = "BiskHubIcon"
IconImage.Image = "rbxassetid://17237307609"
IconImage.Size = UDim2.new(0, 48, 0, 48)
IconImage.Position = UDim2.new(0, 20, 0, 20)
IconImage.BackgroundTransparency = 1
IconImage.Visible = false
IconImage.ZIndex = 20 -- Garantir que fica acima das outras GUIs
IconImage.Parent = screenGui


local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 250, 0, 140)
frame.Position = UDim2.new(0, 16, 0, 100)
frame.BackgroundColor3 = Color3.fromRGB(36,36,36)
frame.BorderSizePixel = 0
frame.Name = "MainFrame"
frame.Active = true
frame.Draggable = true
frame.ZIndex = 10
frame.Parent = screenGui


local dragBar = Instance.new("Frame")
dragBar.Size = UDim2.new(1, 0, 0, 34)
dragBar.BackgroundColor3 = Color3.fromRGB(26,26,26)
dragBar.BorderSizePixel = 0
dragBar.Name = "DragBar"
dragBar.ZIndex = 11
dragBar.Parent = frame

local title = Instance.new("TextLabel")
title.Text = "BiskHub"
title.Font = Enum.Font.SourceSansBold
title.TextSize = 28
title.TextColor3 = Color3.fromRGB(255,255,255)
title.BackgroundTransparency = 1
title.Size = UDim2.new(1, 0, 1, 0)
title.ZIndex = 12
title.Parent = dragBar


local closeBtn = Instance.new("TextButton")
closeBtn.Text = "✕"
closeBtn.Size = UDim2.new(0, 32, 0, 32)
closeBtn.Position = UDim2.new(1, -36, 0, 2)
closeBtn.BackgroundColor3 = Color3.fromRGB(60,60,60)
closeBtn.TextColor3 = Color3.fromRGB(255,255,255)
closeBtn.Font = Enum.Font.SourceSansBold
closeBtn.TextSize = 20
closeBtn.BorderSizePixel = 0
closeBtn.ZIndex = 13
closeBtn.Parent = dragBar

local collectBtn = Instance.new("TextButton")
collectBtn.Text = "Auto Coletar Itens [Desligado]"
collectBtn.Size = UDim2.new(1, -24, 0, 40)
collectBtn.Position = UDim2.new(0, 12, 0, 40)
collectBtn.BackgroundColor3 = Color3.fromRGB(60,130,255)
collectBtn.TextColor3 = Color3.fromRGB(255,255,255)
collectBtn.Font = Enum.Font.SourceSansSemibold
collectBtn.TextSize = 22
collectBtn.ZIndex = 11
collectBtn.Parent = frame

local fishBtn = Instance.new("TextButton")
fishBtn.Text = "Auto Pescar [Desligado]"
fishBtn.Size = UDim2.new(1, -24, 0, 40)
fishBtn.Position = UDim2.new(0, 12, 0, 90)
fishBtn.BackgroundColor3 = Color3.fromRGB(60,200,130)
fishBtn.TextColor3 = Color3.fromRGB(255,255,255)
fishBtn.Font = Enum.Font.SourceSansSemibold
fishBtn.TextSize = 22
fishBtn.ZIndex = 11
fishBtn.Parent = frame

local autoCollect = false
local autoFish = false


local mouseHeld = false
local function holdMouse(x, y)
    if not mouseHeld then
        VirtualInputManager:SendMouseButtonEvent(x, y, 0, true, game, 0)
        mouseHeld = true
    end
end
local function releaseMouse(x, y)
    if mouseHeld then
        VirtualInputManager:SendMouseButtonEvent(x, y, 0, false, game, 0)
        mouseHeld = false
    end
end


local function autoFishFunc()
    while autoFish do
        local pointer, radar
        for _, gui in ipairs(playerGui:GetDescendants()) do
            if gui:IsA("Frame") and gui.Name:lower() == "pointer" and gui.Visible then
                pointer = gui
            elseif gui:IsA("Frame") and gui.Name:lower() == "radar" and gui.Visible then
                radar = gui
            end
        end
        if pointer and radar then
            local pointerY = pointer.AbsolutePosition.Y + pointer.AbsoluteSize.Y/2
            local radarTop = radar.AbsolutePosition.Y
            local radarBottom = radar.AbsolutePosition.Y + radar.AbsoluteSize.Y
            local screenX = pointer.AbsolutePosition.X + pointer.AbsoluteSize.X/2
            local screenY = pointerY

            if pointerY < radarTop then
                holdMouse(screenX, screenY) -- Segure para subir
            elseif pointerY > radarBottom then
                releaseMouse(screenX, screenY) -- Solte para descer
            else
                holdMouse(screenX, screenY) -- Dentro da barra, tente manter pressionado para estabilizar
            end
        else
            releaseMouse(workspace.CurrentCamera.ViewportSize.X/2, workspace.CurrentCamera.ViewportSize.Y/2)
        end
        task.wait(0.02)
    end
    releaseMouse(workspace.CurrentCamera.ViewportSize.X/2, workspace.CurrentCamera.ViewportSize.Y/2)
end


local function autoCollectItems()
    while autoCollect do
        local character = player.Character or player.CharacterAdded:Wait()
        local hrp = character:FindFirstChild("HumanoidRootPart")
        if not hrp then task.wait(1) continue end
        for _, obj in ipairs(workspace:GetDescendants()) do
            if obj:IsA("BasePart") and (obj.Name:lower():find("item") or obj.Name:lower():find("drop") or obj.Name:lower():find("orb")) then
                pcall(function()
                    firetouchinterest(hrp, obj, 0)
                    task.wait(0.05)
                    firetouchinterest(hrp, obj, 1)
                end)
            end
        end
        task.wait(1)
    end
end

collectBtn.MouseButton1Click:Connect(function()
    autoCollect = not autoCollect
    collectBtn.Text = "Auto Coletar Itens [" .. (autoCollect and "Ligado" or "Desligado") .. "]"
    if autoCollect then
        task.spawn(autoCollectItems)
    end
end)

fishBtn.MouseButton1Click:Connect(function()
    autoFish = not autoFish
    fishBtn.Text = "Auto Pescar [" .. (autoFish and "Ligado" or "Desligado") .. "]"
    if autoFish then
        task.spawn(autoFishFunc)
    end
end)


do
    local dragging, dragInput, dragStart, startPos
    dragBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = frame.Position

            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    dragBar.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            dragInput = input
        end
    end)
    UIS.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - dragStart
            frame.Position = UDim2.new(
                startPos.X.Scale, startPos.X.Offset + delta.X,
                startPos.Y.Scale, startPos.Y.Offset + delta.Y
            )
        end
    end)
end


closeBtn.MouseButton1Click:Connect(function()
    frame.Visible = false
    IconImage.Visible = true
    print("Ícone ativado!") -- Debug
end)

-- Ao clicar no ícone, volta a exibir a Hub
IconImage.MouseButton1Click:Connect(function()
    frame.Visible = true
    IconImage.Visible = false
    print("Hub reaberta pelo ícone!") -- Debug
end)
